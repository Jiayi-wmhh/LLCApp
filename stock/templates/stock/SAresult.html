<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
        <title> Stock News</title>
    </head>

    <body>
        <h1 id = "header">Result</h1>
        <div class = "pie">
            <canvas id="myChart" style="width:100%;max-width:600px"></canvas>
        </div>
        <div>
            <table id = "result_table">
                <tr>
                    <th>Sentiment_Analysis_Score</th>
                    <th>Text</th>
                </tr>
            </table>
        </div>

    </body> 
</html>

<script>
    var result_table = document.getElementById("result_table");
    var res_json = JSON.parse('{{ Result | escapejs }}');
    res_json = JSON.parse(res_json)
    var data_size =  res_json.length
    var i = 0;
    var pos_num = 0;
    var neg_num = 0;
    var neu_num= 0;
    document.getElementById("header").innerHTML += " for " + res_json[0]["ticker"];
    while(i < data_size - 1){
        if(res_json[i]["text"].substring(0,15) == res_json[i+1]["text"].substring(0,15)){
            i++;
            continue;
        }
        result_table.innerHTML += '<tr><th>' + res_json[i]["compound"] + '</th><th>'  +res_json[i]["text"]+'</th><tr>';
        
        let val = res_json[i]["compound"]
        if (val < 0){
            neg_num++;
        }
        else if(val >0){
            pos_num++;
        }
        else{
            neu_num++;
        }
        i++;
    }
    //chart
    var xValues = ["Postive", "Neutral", "Negative"];
    var yValues = [pos_num,neu_num,neg_num];
    var barColors = [
    "#b91d47",
    "#00aba9",
    "#2b5797"
    ];
    console.log(yValues)
    new Chart("myChart", {
    type: "pie",
    data: {
        labels: xValues,
        datasets: [{
        backgroundColor: barColors,
        data: yValues
        }]
    },
    options: {
        title: {
        display: true,
        text: "Sentimental Analysis Result Chart " + res_json[0]["ticker"]
        }
    }
    });

</script>

<style>
    table,th,td{
        border: 1px solid grey;
        border-radius: 4px;
    }
    .pie{
        margin-left: auto;    
    }
</style>